<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Seller Chat Assistant Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* === 1. TEMA & VARIABEL === */
        :root {
            --primary: #FE2C55;
            --primary-hover: #e0244a;
            --primary-light: rgba(254, 44, 85, 0.1);
            --bg-body: #f0f2f5;
            --bg-card: #ffffff;
            --bg-panel: #fafafa;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 2px 10px rgba(0,0,0,0.06);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-xl: 0 10px 40px rgba(0,0,0,0.12);
            --danger: #ef4444;
            --danger-hover: #dc2626;
            --success: #10b981;
            --warning: #f59e0b;
            --warning-bg: #fff1f2;
            --header-bg: #ffffff;
            --color-cat-default: #3b82f6;
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-panel: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --shadow: 0 2px 10px rgba(0,0,0,0.15);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.25);
            --shadow-xl: 0 10px 40px rgba(0,0,0,0.35);
            --warning-bg: #450a0a;
            --header-bg: #1e293b;
            --primary-light: rgba(254, 44, 85, 0.15);
        }

        /* === 2. RESET & BASE === */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            transition: var(--transition);
            padding-bottom: 150px;
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }

        /* === 3. HEADER & NAVIGATION === */
        .sticky-header {
            background-color: var(--header-bg);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .header-left { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }

        .app-title {
            margin: 0; 
            font-size: 18px; 
            font-weight: 800; 
            letter-spacing: -0.5px; 
            background: linear-gradient(135deg, var(--primary), #ff6b9c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }

        .btn-top { 
            padding: 8px 12px; 
            font-size: 12px; 
            border-radius: var(--radius-sm); 
            border: 1px solid var(--border); 
            background: var(--bg-card); 
            color: var(--text-main); 
            cursor: pointer; 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            transition: var(--transition-fast);
            box-shadow: var(--shadow);
            touch-action: manipulation;
            height: 36px;
        }

        .btn-top:hover, .btn-top:active {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Tombol Ekspor/Impor */
        .btn-export {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
        }

        .btn-import {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
        }

        /* Theme Switch */
        .theme-switch { 
            position: relative; 
            display: inline-block; 
            width: 44px; 
            height: 24px; 
        } 

        .theme-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }

        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #ccc; 
            transition: var(--transition); 
            border-radius: 34px; 
        }

        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 18px; 
            width: 18px; 
            left: 3px; 
            bottom: 3px; 
            background-color: white; 
            transition: var(--transition); 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider { 
            background-color: var(--primary); 
        }

        input:checked + .slider:before { 
            transform: translateX(20px); 
        }

        /* Language Selector */
        .language-selector {
            position: relative;
            display: inline-block;
        }

        .lang-btn {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-main);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition-fast);
            height: 36px;
        }

        .lang-btn:hover {
            background: var(--bg-panel);
        }

        .lang-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            min-width: 120px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            margin-top: 5px;
            overflow: hidden;
        }

        .lang-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .lang-option {
            padding: 10px 12px;
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--border);
        }

        .lang-option:last-child {
            border-bottom: none;
        }

        .lang-option:hover {
            background: var(--bg-panel);
        }

        .lang-option.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        /* === 4. INFO BAR === */
        .info-bar {
            background: linear-gradient(135deg, var(--primary), #ff6b9c);
            color: white;
            padding: 10px 16px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .info-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        /* === 5. MAIN CONTENT LAYOUT === */
        #app-container {
            max-width: 1200px;
            margin: 15px auto;
            padding: 0 12px;
            display: flex; 
            flex-direction: column;
            gap: 15px;
        }

        /* Tablet dan Desktop */
        @media (min-width: 768px) {
            #app-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                padding: 0 16px;
            }
            
            .left-column, .right-column {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Desktop besar */
        @media (min-width: 1024px) {
            #app-container {
                gap: 25px;
                padding: 0 20px;
            }
        }

        /* === 6. CATEGORY & CARD STYLES === */
        .category-item {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 0; 
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            flex-direction: column;
        }

        .category-item:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-light);
        }

        .category-header {
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            background: var(--bg-card);
            transition: var(--transition-fast);
            flex-shrink: 0;
            -webkit-user-select: none;
            user-select: none;
        }

        .category-header:active {
            background: var(--bg-panel);
        }

        @media (min-width: 768px) {
            .category-header:hover {
                background: var(--bg-panel);
            }
        }

        .header-content { 
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-weight: 600; 
            font-size: 15px; 
            color: var(--text-main); 
            padding: 5px 0; 
        }

        /* Panel Isi: Area Submenu */
        .panel { 
            max-height: 0;
            overflow: hidden;
            padding: 0 16px;
            background-color: var(--bg-panel); 
            border-top: 1px solid transparent; 
            transition: max-height 0.3s ease, padding 0.3s ease;
            flex-grow: 1;
        }

        .panel.open { 
            max-height: 1000px;
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        /* Script Card (Compact) */
        .script-card {
            background: var(--bg-card);
            padding: 14px;
            margin: 8px 0;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            position: relative;
            border-left: 4px solid var(--color-cat);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .script-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-left-width: 6px;
        }

        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }

        .card-title { 
            font-size: 13px; 
            font-weight: 700; 
            color: var(--primary); 
            letter-spacing: -0.2px;
        }

        .card-body {
            font-size: 14px;
            line-height: 1.6;
            padding: 12px;
            background: var(--bg-body);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .card-body:active {
            background: var(--bg-panel);
            border-color: var(--border);
        }

        @media (min-width: 768px) {
            .card-body:hover {
                background: var(--bg-panel);
                border-color: var(--border);
            }
        }

        .tap-hint {
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 5px;
            font-style: italic;
        }

        /* === 7. FORM ELEMENTS === */
        .form-input { 
            width: 100%; 
            padding: 10px 12px; 
            font-size: 14px; 
            margin-bottom: 10px;
            border: 1px solid var(--border); 
            background: var(--bg-body); 
            color: var(--text-main); 
            border-radius: var(--radius-sm); 
            box-sizing: border-box;
            transition: var(--transition-fast);
            -webkit-appearance: none;
            font-family: 'Inter', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .btn { 
            padding: 8px 14px; 
            font-size: 13px; 
            border-radius: var(--radius-sm); 
            gap: 6px; 
            border: none;
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            touch-action: manipulation;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover, .btn-primary:active {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(254, 44, 85, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover, .btn-danger:active {
            background: var(--danger-hover);
            transform: translateY(-1px);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-icon {
            padding: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        /* === 8. CREATE FOLDER PANEL === */
        .create-folder-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            z-index: 90;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 420px;
        }

        .create-folder-panel.minimized {
            height: 46px;
            max-height: 46px;
            width: 200px;
            border-radius: var(--radius);
        }

        .create-folder-panel.minimized .panel-body {
            display: none;
        }

        .panel-header {
            padding: 12px 16px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-minimize {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .panel-minimize:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .panel-body {
            padding: 16px;
            max-height: 340px;
            overflow-y: auto;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
            margin-top: 8px;
        }

        .example-item {
            background: var(--bg-panel);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-top: 16px;
            border: 1px dashed var(--border);
        }

        .example-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 6px;
            font-size: 13px;
        }

        .example-text {
            font-size: 12px;
            line-height: 1.5;
            color: var(--text-muted);
        }

        /* === 9. TOAST NOTIFICATION === */
        #toast {
            visibility: hidden;
            min-width: 300px;
            background-color: var(--success);
            color: white;
            text-align: center;
            border-radius: var(--radius);
            padding: 14px 20px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-weight: 500;
            box-shadow: var(--shadow-xl);
            transition: visibility 0s, opacity 0.3s ease;
            opacity: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            animation: slideUp 0.3s ease;
        }

        /* === 10. STORAGE INFO PANEL === */
        .storage-info-panel {
            max-width: 600px;
            margin: 20px auto 10px;
            padding: 14px 16px;
            background: var(--bg-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .storage-info-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
        }

        .storage-info-text {
            font-size: 13px;
            color: var(--text-muted);
        }

        .storage-info-text strong {
            color: var(--primary);
        }

        .storage-actions {
            display: flex;
            gap: 8px;
        }

        .btn-check-storage, .btn-clear-storage {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition-fast);
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-panel);
            color: var(--text-main);
        }

        .btn-clear-storage {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-clear-storage:hover {
            background: var(--danger-hover);
        }

        .btn-check-storage:hover {
            background: var(--bg-body);
        }

        /* === 11. FLAG COUNTER === */
        .flag-counter-container {
            text-align: center;
            margin: 25px auto 15px;
            padding: 16px;
            max-width: 600px;
            border-radius: var(--radius);
            background: var(--bg-card);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .flag-counter-img {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .flag-counter-img:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* === 12. UTILITIES & ANIMATIONS === */
        .hidden { display: none !important; }

        .risk-alert {
            background: var(--warning-bg);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .drag-handle {
            cursor: move;
            color: var(--text-muted);
            transition: var(--transition-fast);
            touch-action: none;
            padding: 4px;
        }

        .drag-handle:hover {
            color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
            font-size: 16px;
            opacity: 0.7;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        @keyframes copySuccess {
            0% { transform: translateX(-50%) scale(0.9); opacity: 0; }
            70% { transform: translateX(-50%) scale(1.05); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }

        .category-item, .script-card {
            animation: fadeIn 0.3s ease;
        }

        .copy-success {
            animation: copySuccess 0.4s ease-out;
        }

        /* === 13. RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            body {
                padding-bottom: 180px;
            }
            
            .sticky-header {
                padding: 10px 12px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
                order: 3;
                margin-top: 8px;
            }
            
            .app-title {
                font-size: 16px;
            }
            
            .info-bar {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            #app-container {
                padding: 0 10px;
                margin: 12px auto;
            }
            
            .create-folder-panel {
                width: calc(100% - 24px);
                right: 12px;
                bottom: 12px;
                max-height: 70vh;
            }
            
            .create-folder-panel.minimized {
                width: 160px;
                bottom: 12px;
                right: 12px;
            }
            
            .panel-header h3 {
                font-size: 14px;
            }
            
            .storage-info-panel {
                margin: 16px 12px 10px;
                flex-direction: column;
                text-align: center;
            }
            
            .storage-info-content {
                justify-content: center;
                margin-bottom: 10px;
            }
            
            .storage-actions {
                justify-content: center;
                width: 100%;
            }
            
            .flag-counter-container {
                margin: 20px 12px 10px;
                padding: 12px;
            }
            
            #toast {
                min-width: 280px;
                font-size: 13px;
                padding: 12px 16px;
                bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .btn-top {
                padding: 6px 8px;
                font-size: 11px;
            }
            
            .lang-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            .theme-switch {
                width: 40px;
                height: 22px;
            }
        }

        /* Perbaikan untuk iOS */
        @supports (-webkit-touch-callout: none) {
            .category-header, .card-body, .btn, .panel-header {
                cursor: pointer;
            }
            
            input, textarea {
                font-size: 16px; /* Mencegah zoom di iOS */
            }
        }

        /* Scrollbar styling */
        .panel-body::-webkit-scrollbar {
            width: 6px;
        }

        .panel-body::-webkit-scrollbar-track {
            background: var(--bg-body);
            border-radius: 3px;
        }

        .panel-body::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .panel-body::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="sticky-header">
        <div class="header-left">
            <h1 class="app-title" id="app-title">Seller Chat Assistant Pro</h1>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                    <input type="checkbox" id="checkbox" onchange="toggleTheme(this)">
                    <div class="slider round"></div>
                </label>
            </div>
        </div>

        <div class="header-actions">
            <button class="btn-top btn-export" onclick="exportData()">
                <i class="fas fa-download"></i> <span id="export-btn">Export</span>
            </button>
            
            <button class="btn-top btn-import" onclick="document.getElementById('importFile').click()">
                <i class="fas fa-upload"></i> <span id="import-btn">Import</span>
            </button>
            <input type="file" id="importFile" accept=".txt" style="display: none;" onchange="importData(event)">
            
            <div class="language-selector">
                <button class="lang-btn" onclick="toggleLanguageDropdown()">
                    <i class="fas fa-globe"></i>
                    <span id="current-lang">ID</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="lang-dropdown" id="lang-dropdown">
                    <div class="lang-option active" data-lang="id" onclick="changeLanguage('id')">
                        <span>üáÆüá© Indonesia</span>
                    </div>
                    <div class="lang-option" data-lang="en" onclick="changeLanguage('en')">
                        <span>üá∫üá∏ English</span>
                    </div>
                </div>
            </div>
            
            <button class="btn-top btn-reset" onclick="resetToDefault()">
                <i class="fas fa-rotate-left"></i> <span id="reset-btn">Reset</span>
            </button>
            <button class="btn-top btn-clear" onclick="deleteAll()">
                <i class="fas fa-trash-alt"></i> <span id="delete-btn">Hapus Semua</span>
            </button>
        </div>
    </div>

    <!-- INFO BAR -->
    <div class="info-bar">
        <i class="fas fa-shield-alt"></i> <b id="info-title">INFO PENTING:</b> <span id="info-text">Hindari kata sensitif di balasan chat. Mendukung input semua bahasa!</span>
    </div>

    <!-- MAIN CONTENT -->
    <div id="app-container"></div>

    <!-- STORAGE INFO -->
    <div class="storage-info-panel">
        <div class="storage-info-content">
            <i class="fas fa-database" style="color: var(--primary);"></i>
            <div class="storage-info-text">
                <strong id="storage-title">PENYIMPANAN LOKAL:</strong> 
                <span id="storage-text">Semua data disimpan otomatis di cache browser (LocalStorage) - TANPA KADALUARSA! Data tetap tersedia meski browser ditutup.</span>
            </div>
        </div>
        <div class="storage-actions">
            <button class="btn-check-storage" onclick="checkStorageUsage()">
                <i class="fas fa-chart-pie"></i> <span id="check-storage-btn">Cek Storage</span>
            </button>
            <button class="btn-clear-storage" onclick="clearAllStorage()">
                <i class="fas fa-broom"></i> <span id="clear-storage-btn">Bersihkan Semua</span>
            </button>
        </div>
    </div>

    <!-- FLAG COUNTER -->
    <div class="flag-counter-container">
        <a href="https://info.flagcounter.com/LmOi" target="_blank">
            <img src="https://s01.flagcounter.com/count/LmOi/bg_050B42/txt_FFFFFF/border_CCCCCC/columns_2/maxflags_10/viewers_Total+Visit/labels_1/pageviews_1/flags_0/percent_1/" 
                 alt="Flag Counter" 
                 border="0"
                 class="flag-counter-img">
        </a>
    </div>

    <!-- CREATE FOLDER PANEL -->
    <div class="create-folder-panel" id="createFolderPanel">
        <div class="panel-header" onclick="toggleCreateFolderPanel()">
            <h3><i class="fas fa-folder-plus"></i> <span id="modal-title">Buat Folder Baru</span></h3>
            <button class="panel-minimize">
                <i class="fas fa-minus"></i>
            </button>
        </div>
        
        <div class="panel-body" id="panelBody">
            <div class="form-group">
                <label class="form-label" id="folder-name-label">Nama Folder:</label>
                <input type="text" class="form-input" id="newFolderName" placeholder="Nama Folder Baru">
                <div class="form-hint" id="folder-name-hint">Masukkan nama deskriptif untuk folder baru Anda</div>
            </div>
            
            <div class="example-item">
                <div class="example-title" id="example-title">üìÅ Contoh Folder:</div>
                <div class="example-text" id="example-text">
                    Setelah dibuat, folder ini akan berisi contoh pesan yang bisa diedit.
                </div>
            </div>
            
            <button class="btn btn-primary btn-block" onclick="createNewFolderFromPanel()">
                <i class="fas fa-check"></i> <span id="create-btn">Buat Folder</span>
            </button>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-text">‚úÖ Teks berhasil disalin!</span></div>

    <script>
        // === 1. DATA MASTER (DUA BAHASA) ===
        const defaultData = {
            id: [
                { 
                    id: 'cat_0', 
                    title: 'Cek Stok (Ready/Habis)', 
                    icon: 'fa-cubes', 
                    color: '#3b82f6', 
                    items: [
                        { id: 'm01', title: 'Barang Ready Stock', text: 'Hai Kak! Produk ini READY STOCK dan siap kirim ya. Selama varian masih bisa diklik, berarti barang tersedia. Silakan langsung di-checkout sebelum kehabisan! üî•' },
                        { id: 'm02', title: 'Stok Habis/Kosong', text: 'Mohon maaf Kak, untuk varian tersebut saat ini sedang habis (Sold Out). üôè Kami akan restock secepatnya. Boleh follow toko kami untuk update terbarunya ya. Terima kasih!' },
                        { id: 'm03', title: 'Stok Menipis', text: 'Hai Kak, stoknya tinggal sedikit lagi nih. Siapa cepat dia dapat ya Kak. Yuk segera diamankan pesanannya sekarang! üòä' }
                    ]
                },
                { 
                    id: 'cat_1', 
                    title: 'Komplain & Review Buruk', 
                    icon: 'fa-triangle-exclamation', 
                    color: '#ef4444', 
                    items: [
                        { id: 'm11', title: 'Minta Maaf & Solusi (Sopan)', text: 'Mohon maaf atas ketidaknyamanannya, Kak. Kepuasan Kakak adalah prioritas kami. Boleh tolong infokan detail kendalanya via chat ini agar kami bisa bantu berikan solusi terbaik? Terima kasih.' },
                        { id: 'm12', title: 'Respons Bintang 1 Tanpa Alasan', text: 'Halo Kak, mohon maaf jika produk kami tidak memenuhi ekspektasi. Kami selalu berusaha memberikan yang terbaik. Jika ada cacat produk, mohon chat kami untuk proses klaim garansi/retur ya Kak. üôè' }
                    ]
                },
                { 
                    id: 'cat_2', 
                    title: 'Balasan Ulasan Bintang 5', 
                    icon: 'fa-star', 
                    color: '#f59e0b', 
                    items: [
                        { id: 'm21', title: 'Terima Kasih Standard', text: 'Terima kasih banyak ulasan bintang 5-nya Kak! üòç Senang sekali Kakak suka dengan produknya. Semoga awet dan ditunggu orderan selanjutnya ya!' },
                        { id: 'm22', title: 'Doa Rezeki (Ramah)', text: 'Alhamdulillah, terima kasih Kak sudah belanja di toko kami. Semoga rezekinya lancar terus ya Kak. Ditunggu next ordernya! ‚ù§Ô∏è' }
                    ]
                },
                { 
                    id: 'cat_3', 
                    title: 'Pengiriman & Logistik', 
                    icon: 'fa-truck-fast', 
                    color: '#10b981', 
                    items: [
                        { id: 'm31', title: 'Kapan Dikirim?', text: 'Pesanan yang masuk sebelum jam 15.00 akan dikirim hari ini ya Kak. Resi update otomatis malam hari. Mohon ditunggu update statusnya di aplikasi. Terima kasih! üöö' },
                        { id: 'm32', title: 'Paket Belum Jalan (Stuck)', text: 'Halo Kak, fisik paket sudah kami serahkan ke pihak ekspedisi ya. Saat ini status di sistem mungkin delay update dari pihak kurirnya. Mohon kesediaannya menunggu 1x24 jam kedepan ya Kak. üôè' },
                        { id: 'm33', title: 'Paket Hilang/Lama Sampai', text: 'Mohon maaf atas keterlambatannya Kak. Kami sudah bantu follow-up ke pihak ekspedisi terkait paket Kakak. Jika dalam 2 hari tidak ada pergerakan, silakan ajukan pengembalian dana (paket hilang) via sistem ya Kak.' }
                    ]
                },
                { 
                    id: 'cat_4', 
                    title: 'Paket Tidak Sesuai/Rusak', 
                    icon: 'fa-box-open', 
                    color: '#6366f1', 
                    items: [
                        { id: 'm41', title: 'Minta Bukti Video', text: 'Mohon maaf atas kendalanya Kak. üôè Bisa tolong lampirkan video unboxing (buka paket) agar bisa kami bantu pengecekan dengan tim packing? Kami akan bertanggung jawab penuh jika ada kesalahan.' },
                        { id: 'm42', title: 'Barang Cacat/Rusak', text: 'Waduh, mohon maaf sekali barang sampai dalam kondisi rusak. Jangan selesaikan pesanan dulu ya Kak. Silakan ajukan pengembalian barang/dana via aplikasi, nanti kami approve segera.' }
                    ]
                },
                { 
                    id: 'cat_5', 
                    title: 'Masalah Return (Pengembalian)', 
                    icon: 'fa-rotate-left', 
                    color: '#a855f7', 
                    items: [
                        { id: 'm51', title: 'Cara Mengajukan Return', text: 'Halo Kak, untuk proses retur yang aman, silakan klik tombol \'Ajukan Pengembalian\' pada rincian pesanan Kakak. Ikuti instruksi di aplikasi untuk mendapatkan resi pengembalian gratis ongkir.' },
                        { id: 'm52', title: 'Return Ditolak (Salah Alasan)', text: 'Halo Kak, pengajuan returnya kami tolak dulu karena alasan yang dipilih kurang tepat. Silakan ajukan ulang dengan memilih alasan "Barang Berubah Pikiran" atau "Produk Tidak Berfungsi" ya Kak agar bisa kami proses.' }
                    ]
                },
                { 
                    id: 'cat_6', 
                    title: 'Barang Tertukar', 
                    icon: 'fa-arrow-right-arrow-left', 
                    color: '#ec4899', 
                    items: [
                        { id: 'm61', title: 'Salah Kirim Varian', text: 'Mohon maaf Kak, sepertinya tim packing kami salah menempelkan resi/mengambil barang. üôè Kami akan kirimkan barang penggantinya. Silakan ajukan penukaran barang di sistem ya Kak.' }
                    ]
                },
                { 
                    id: 'cat_7', 
                    title: 'Produk Tidak Berfungsi (Trouble)', 
                    icon: 'fa-plug', 
                    color: '#f97316', 
                    items: [
                        { id: 'm71', title: 'Panduan Pemakaian', text: 'Halo Kak, untuk produk ini apakah sudah dicoba [Isi Instruksi Singkat, misal: cas dulu 2 jam]? Terkadang produk butuh daya awal. Jika masih tidak menyala, kami siap ganti baru.' }
                    ]
                },
                { 
                    id: 'cat_8', 
                    title: 'Pertanyaan Umum (COD/Asli)', 
                    icon: 'fa-circle-question', 
                    color: '#06b6d4', 
                    items: [
                        { id: 'm81', title: 'Apakah Bisa COD?', text: 'Bisa banget Kak! Toko kami support COD (Bayar di Tempat) ke seluruh Indonesia. Pastikan alamat lengkap dan nomor HP aktif ya saat checkout. Ditunggu! üòä' },
                        { id: 'm82', title: 'Apakah Produk Original?', text: 'Kami jamin 100% Original Kak. Barang kami ambil langsung dari distributor resmi. Ada garansi uang kembali jika terbukti tidak ori. Silakan diorder dengan tenang. ‚ú®' },
                        { id: 'm83', title: 'Minta Realpict', text: 'Foto yang dipajang di etalase sudah foto asli (Real Picture) dari tim kami ya Kak. Apa yang Kakak lihat, itu yang akan Kakak dapatkan. üëå' }
                    ]
                }
            ],
            en: [
                { 
                    id: 'cat_0', 
                    title: 'Check Stock (Ready/Out)', 
                    icon: 'fa-cubes', 
                    color: '#3b82f6', 
                    items: [
                        { id: 'm01', title: 'Product Ready Stock', text: 'Hi! This product is READY STOCK and ready to ship. As long as the variant can still be clicked, the item is available. Please checkout immediately before it runs out! üî•' },
                        { id: 'm02', title: 'Out of Stock/Empty', text: 'Sorry, for that variant is currently out of stock (Sold Out). üôè We will restock as soon as possible. Please follow our store for the latest updates. Thank you!' },
                        { id: 'm03', title: 'Stock Running Low', text: 'Hi, stock is running low. First come first served. Secure your order now! üòä' }
                    ]
                },
                { 
                    id: 'cat_1', 
                    title: 'Complaints & Bad Reviews', 
                    icon: 'fa-triangle-exclamation', 
                    color: '#ef4444', 
                    items: [
                        { id: 'm11', title: 'Apology & Solution (Polite)', text: 'We apologize for the inconvenience. Your satisfaction is our priority. Could you please provide details about the issue via this chat so we can help provide the best solution? Thank you.' },
                        { id: 'm12', title: 'Response to 1 Star Without Reason', text: 'Hello, we apologize if our product did not meet expectations. We always strive to provide the best. If there is a product defect, please chat us for the warranty/return claim process. üôè' }
                    ]
                },
                { 
                    id: 'cat_2', 
                    title: '5 Star Review Replies', 
                    icon: 'fa-star', 
                    color: '#f59e0b', 
                    items: [
                        { id: 'm21', title: 'Standard Thank You', text: 'Thank you so much for the 5 star review! üòç We are very happy that you like our product. May it last long and we look forward to your next order!' },
                        { id: 'm22', title: 'Blessing Prayer (Friendly)', text: 'Alhamdulillah, thank you for shopping at our store. May your prosperity continue to flow. We await your next order! ‚ù§Ô∏è' }
                    ]
                },
                { 
                    id: 'cat_3', 
                    title: 'Shipping & Logistics', 
                    icon: 'fa-truck-fast', 
                    color: '#10b981', 
                    items: [
                        { id: 'm31', title: 'When Will It Be Shipped?', text: 'Orders placed before 3:00 PM will be shipped today. Tracking number updates automatically in the evening. Please wait for status updates in the app. Thank you! üöö' },
                        { id: 'm32', title: 'Package Not Moving (Stuck)', text: 'Hello, the physical package has been handed over to the expedition party. Currently the status in the system may be delayed update from the courier side. Please wait 1x24 hours ahead. üôè' },
                        { id: 'm33', title: 'Package Lost/Late Arrival', text: 'We apologize for the delay. We have helped follow up with the expedition regarding your package. If there is no movement within 2 days, please submit a refund request (lost package) via the system.' }
                    ]
                },
                { 
                    id: 'cat_4', 
                    title: 'Wrong/Damaged Package', 
                    icon: 'fa-box-open', 
                    color: '#6366f1', 
                    items: [
                        { id: 'm41', title: 'Request Video Evidence', text: 'We apologize for the trouble. üôè Could you please attach an unboxing video (opening package) so we can help check with the packing team? We will be fully responsible if there is an error.' },
                        { id: 'm42', title: 'Defective/Damaged Item', text: 'Oh no, we are very sorry the item arrived damaged. Please do not complete the order yet. Please submit a return/refund request via the application, we will approve immediately.' }
                    ]
                },
                { 
                    id: 'cat_5', 
                    title: 'Return Issues', 
                    icon: 'fa-rotate-left', 
                    color: '#a855f7', 
                    items: [
                        { id: 'm51', title: 'How to Submit Return', text: 'Hello, for a safe return process, please click the \'Submit Return\' button in your order details. Follow the instructions in the application to get a free return shipping tracking number.' },
                        { id: 'm52', title: 'Return Rejected (Wrong Reason)', text: 'Hello, we rejected the return request because the reason chosen was not appropriate. Please resubmit by selecting the reason "Changed Mind" or "Product Not Working" so we can process it.' }
                    ]
                },
                { 
                    id: 'cat_6', 
                    title: 'Swapped Items', 
                    icon: 'fa-arrow-right-arrow-left', 
                    color: '#ec4899', 
                    items: [
                        { id: 'm61', title: 'Wrong Variant Sent', text: 'We apologize, it seems our packing team stuck the wrong tracking number/took the wrong item. üôè We will send the replacement item. Please submit an item exchange request in the system.' }
                    ]
                },
                { 
                    id: 'cat_7', 
                    title: 'Product Not Working (Trouble)', 
                    icon: 'fa-plug', 
                    color: '#f97316', 
                    items: [
                        { id: 'm71', title: 'Usage Guide', text: 'Hello, for this product, have you tried [Fill Brief Instruction, e.g.: charge for 2 hours first]? Sometimes products need initial power. If it still doesn\'t work, we are ready to replace it with a new one.' }
                    ]
                },
                { 
                    id: 'cat_8', 
                    title: 'Frequently Asked Questions (COD/Original)', 
                    icon: 'fa-circle-question', 
                    color: '#06b6d4', 
                    items: [
                        { id: 'm81', title: 'Is COD Available?', text: 'Yes, definitely! Our store supports COD (Cash on Delivery) throughout Indonesia. Make sure your address is complete and your mobile number is active when checking out. We await your order! üòä' },
                        { id: 'm82', title: 'Is the Product Original?', text: 'We guarantee 100% Original. Our items are taken directly from official distributors. There is a money back guarantee if proven not original. Please order with peace of mind. ‚ú®' },
                        { id: 'm83', title: 'Request Real Photo', text: 'The photos displayed in the showcase are original photos (Real Picture) from our team. What you see is what you will get. üëå' }
                    ]
                }
            ]
        };

        // === 2. KONFIGURASI ===
        let appData = [];
        const STORAGE_KEY = 'SellerTiktokChatPro_Data'; 
        const LANGUAGE_KEY = 'SellerTiktokChatPro_Language';
        const BANNED_KEYWORDS = ["whatsapp", "wa ", "08", "no hp", "ig", "instagram", "shopee", "tokopedia", "lazada", "tf", "transfer", "bca", "mandiri", "diluar aplikasi", "putih instan", "permanen", "garansi uang kembali", "kw", "ori reject"];
        
        let currentLanguage = 'id';
        let isPanelMinimized = false;

        // === 3. MULTI BAHASA ===
        const translations = {
            id: {
                // Header
                'app-title': 'Seller Chat Assistant Pro',
                'reset-btn': 'Reset',
                'delete-btn': 'Hapus Semua',
                'info-title': 'INFO PENTING:',
                'info-text': 'Hindari kata sensitif di balasan chat. Mendukung input semua bahasa!',
                'toast-text': '‚úÖ Teks berhasil disalin!',
                
                // Categories
                'category-default': 'Nama Folder Baru',
                'add-message': 'Tambah Pesan',
                'message-title': 'Judul Pesan',
                'message-content': 'Tulis balasan di sini... (Mendukung SEMUA bahasa!)',
                'tap-hint': 'Tap teks di atas untuk menyalin',
                
                // Buttons
                'delete-item': 'Hapus',
                'edit-btn': 'Edit',
                'cancel-btn': 'Batal',
                'save-btn': 'Simpan',
                
                // Confirmation Messages
                'confirm-reset': '‚ö†Ô∏è PERINGATAN: Semua data script Anda akan dihapus dan dikembalikan ke pengaturan awal (pabrik).\n\nApakah Anda yakin?',
                'confirm-delete-all': '‚ö†Ô∏è PERINGATAN KERAS: Menu dan semua script akan dihapus TOTAL!\n\nAnda harus membuatnya lagi dari nol.\nApakah Anda yakin?',
                'confirm-delete-category': 'Hapus kategori folder ini?',
                'confirm-delete-message': 'Hapus pesan ini?',
                'confirm-banned-words': '‚ö†Ô∏è Ada kata terlarang (${violations}). Yakin simpan?',
                
                // Success Messages
                'success-reset': 'Data berhasil dikembalikan ke default.',
                
                // Empty State
                'empty-state': 'Belum ada menu tersimpan.<br>Klik tombol (+) di bawah untuk membuat baru.',
                
                // Warning
                'warning-title': 'PERINGATAN',
                'warning-banned': 'Kata "${words}" dilarang.',
                
                // Language
                'current-lang': 'ID',
                
                // Storage Info
                'storage-title': 'PENYIMPANAN LOKAL:',
                'storage-text': 'Semua data disimpan otomatis di cache browser (LocalStorage) - TANPA KADALUARSA! Data tetap tersedia meski browser ditutup.',
                'check-storage-btn': 'Cek Storage',
                'clear-storage-btn': 'Bersihkan Semua',
                'confirm-clear-storage': '‚ö†Ô∏è PERINGATAN: Semua data termasuk tema dan bahasa akan dihapus dari cache browser.\n\nAplikasi akan kembali ke pengaturan pabrik.\nApakah Anda yakin?',
                'storage-cleared': '‚úÖ Semua data cache telah dibersihkan.',
                'storage-info': 'Data tersimpan: ${size} KB',
                'storage-empty': 'Tidak ada data tersimpan',
                
                // Create Folder Panel
                'modal-title': 'Buat Folder Baru',
                'folder-name-label': 'Nama Folder:',
                'folder-name-hint': 'Masukkan nama deskriptif untuk folder baru Anda',
                'example-title': 'üìÅ Contoh Folder:',
                'example-text': 'Setelah dibuat, folder ini akan berisi contoh pesan yang bisa diedit.',
                'create-btn': 'Buat Folder',
                
                // Ekspor/Impor
                'export-btn': 'Ekspor Data',
                'import-btn': 'Impor Data',
                'export-success': '‚úÖ Semua data berhasil diekspor!',
                'import-success': '‚úÖ Data berhasil diimpor!',
                'export-failed': '‚ùå Ekspor gagal!',
                'import-failed': '‚ùå Import gagal!',
                'confirm-import': '‚ö†Ô∏è PERINGATAN: Ini akan menggantikan SEMUA data saat ini.\n\nApakah Anda yakin ingin mengimpor?',
                'invalid-file': '‚ùå Format file tidak valid!'
            },
            en: {
                // Header
                'app-title': 'Seller Chat Assistant Pro',
                'reset-btn': 'Reset',
                'delete-btn': 'Delete All',
                'info-title': 'IMPORTANT INFO:',
                'info-text': 'Avoid sensitive words in chat replies. Supports all languages input!',
                'toast-text': '‚úÖ Text copied successfully!',
                
                // Categories
                'category-default': 'New Folder Name',
                'add-message': 'Add Message',
                'message-title': 'Message Title',
                'message-content': 'Write reply here... (Supports ALL languages!)',
                'tap-hint': 'Tap text above to copy',
                
                // Buttons
                'delete-item': 'Delete',
                'edit-btn': 'Edit',
                'cancel-btn': 'Cancel',
                'save-btn': 'Save',
                
                // Confirmation Messages
                'confirm-reset': '‚ö†Ô∏è WARNING: All your script data will be deleted and restored to factory settings.\n\nAre you sure?',
                'confirm-delete-all': '‚ö†Ô∏è CRITICAL WARNING: All menus and scripts will be COMPLETELY DELETED!\n\nYou will have to create them again from scratch.\nAre you sure?',
                'confirm-delete-category': 'Delete this category folder?',
                'confirm-delete-message': 'Delete this message?',
                'confirm-banned-words': '‚ö†Ô∏è There are banned words (${violations}). Are you sure you want to save?',
                
                // Success Messages
                'success-reset': 'Data successfully restored to default.',
                
                // Empty State
                'empty-state': 'No menus saved yet.<br>Click the (+) button below to create a new one.',
                
                // Warning
                'warning-title': 'WARNING',
                'warning-banned': 'Words "${words}" are banned.',
                
                // Language
                'current-lang': 'EN',
                
                // Storage Info
                'storage-title': 'LOCAL STORAGE:',
                'storage-text': 'All data saved automatically in browser cache (LocalStorage) - NO EXPIRATION! Data remains available even after closing browser.',
                'check-storage-btn': 'Check Storage',
                'clear-storage-btn': 'Clear All',
                'confirm-clear-storage': '‚ö†Ô∏è WARNING: All data including theme and language will be removed from browser cache.\n\nApp will return to factory settings.\nAre you sure?',
                'storage-cleared': '‚úÖ All cache data has been cleared.',
                'storage-info': 'Data stored: ${size} KB',
                'storage-empty': 'No data stored',
                
                // Create Folder Panel
                'modal-title': 'Create New Folder',
                'folder-name-label': 'Folder Name:',
                'folder-name-hint': 'Enter a descriptive name for your new folder',
                'example-title': 'üìÅ Example Folder:',
                'example-text': 'After creating, this folder will contain example messages that can be edited.',
                'create-btn': 'Create Folder',
                
                // Ekspor/Impor
                'export-btn': 'Export Data',
                'import-btn': 'Import Data',
                'export-success': '‚úÖ All data exported successfully!',
                'import-success': '‚úÖ Data imported successfully!',
                'export-failed': '‚ùå Export failed!',
                'import-failed': '‚ùå Import failed!',
                'confirm-import': '‚ö†Ô∏è WARNING: This will replace ALL current data.\n\nAre you sure you want to import?',
                'invalid-file': '‚ùå Invalid file format!'
            }
        };

        // === 4. FUNGSI UTAMA ===
        function init() {
            // Load theme
            const savedTheme = localStorage.getItem('theme');
            if (!savedTheme) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('checkbox').checked = true;
            } else {
                document.documentElement.setAttribute('data-theme', savedTheme);
                if(savedTheme === 'dark') document.getElementById('checkbox').checked = true;
            }

            // Load language
            const savedLanguage = localStorage.getItem(LANGUAGE_KEY);
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            } else {
                currentLanguage = 'id';
                localStorage.setItem(LANGUAGE_KEY, 'id');
            }

            // Load data
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
            }
            
            // Apply language and render
            applyLanguage();
            render();
            
            // Show storage notification
            setTimeout(() => {
                showStorageNotification();
            }, 1000);
        }

        function applyLanguage() {
            const lang = currentLanguage;
            const t = translations[lang];
            
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (t[key]) {
                    element.textContent = t[key];
                }
            });
            
            // Update specific elements
            document.getElementById('app-title').textContent = t['app-title'];
            document.getElementById('reset-btn').textContent = t['reset-btn'];
            document.getElementById('delete-btn').textContent = t['delete-btn'];
            document.getElementById('info-title').textContent = t['info-title'];
            document.getElementById('info-text').textContent = t['info-text'];
            document.getElementById('toast-text').textContent = t['toast-text'];
            document.getElementById('current-lang').textContent = t['current-lang'];
            document.getElementById('storage-title').textContent = t['storage-title'];
            document.getElementById('storage-text').textContent = t['storage-text'];
            document.getElementById('check-storage-btn').textContent = t['check-storage-btn'];
            document.getElementById('clear-storage-btn').textContent = t['clear-storage-btn'];
            document.getElementById('export-btn').textContent = t['export-btn'];
            document.getElementById('import-btn').textContent = t['import-btn'];
            
            // Update panel text
            updatePanelText();
            
            // Update document title
            document.title = t['app-title'];
            
            // Re-render for dynamic text
            if (document.getElementById('app-container').innerHTML !== '') {
                render();
            }
        }

        function t(key, variables = {}) {
            let text = translations[currentLanguage][key] || translations['id'][key] || key;
            
            // Replace variables
            Object.keys(variables).forEach(variable => {
                text = text.replace(`\${${variable}}`, variables[variable]);
            });
            
            return text;
        }

        function updatePanelText() {
            const t = translations[currentLanguage];
            
            // Update panel elements
            const modalTitle = document.getElementById('modal-title');
            const folderNameLabel = document.getElementById('folder-name-label');
            const folderNameHint = document.getElementById('folder-name-hint');
            const exampleTitle = document.getElementById('example-title');
            const exampleText = document.getElementById('example-text');
            const createBtn = document.getElementById('create-btn');
            const input = document.getElementById('newFolderName');
            
            if (modalTitle) modalTitle.textContent = t['modal-title'];
            if (folderNameLabel) folderNameLabel.textContent = t['folder-name-label'];
            if (folderNameHint) folderNameHint.innerHTML = t['folder-name-hint'];
            if (exampleTitle) exampleTitle.textContent = t['example-title'];
            if (exampleText) exampleText.innerHTML = t['example-text'];
            if (createBtn) createBtn.textContent = t['create-btn'];
            
            if (input) {
                input.placeholder = t['category-default'];
                // Jika input kosong atau berisi placeholder lama, update
                if (!input.value || input.value === 'Nama Folder Baru' || input.value === 'New Folder Name') {
                    input.value = '';
                }
            }
        }

        // === 5. CREATE FOLDER PANEL FUNCTIONS ===
        function toggleCreateFolderPanel() {
            const panel = document.getElementById('createFolderPanel');
            const minimizeBtn = panel.querySelector('.panel-minimize i');
            
            isPanelMinimized = !isPanelMinimized;
            
            if (isPanelMinimized) {
                panel.classList.add('minimized');
                minimizeBtn.className = 'fas fa-plus';
            } else {
                panel.classList.remove('minimized');
                minimizeBtn.className = 'fas fa-minus';
                // Focus on input when expanded
                setTimeout(() => {
                    document.getElementById('newFolderName').focus();
                }, 100);
            }
        }

        function createNewFolderFromPanel() {
            const input = document.getElementById('newFolderName');
            const folderName = input.value.trim();
            
            if (!folderName) {
                showToast('‚ùå ' + (currentLanguage === 'en' ? 'Please enter a folder name!' : 'Harap masukkan nama folder!'), 2000);
                return;
            }
            
            const newId = Date.now();
            const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            
            const exampleItem = {
                id: 'example_' + Date.now(),
                title: currentLanguage === 'en' ? 'Example Message' : 'Contoh Pesan',
                text: currentLanguage === 'en' 
                    ? 'Hi! This is an example message. Click on this text to copy it to clipboard. You can edit this message or add new ones using the "Add Message" button below. üòä'
                    : 'Hai! Ini adalah contoh pesan. Klik teks ini untuk menyalin ke clipboard. Anda bisa mengedit pesan ini atau menambah yang baru menggunakan tombol "Tambah Pesan" di bawah. üòä'
            };
            
            const newCategory = {
                id: newId,
                title: folderName,
                icon: 'fa-folder',
                color: randomColor,
                items: [exampleItem]
            };
            
            appData.push(newCategory);
            saveData();
            render();
            
            // Reset input
            input.value = '';
            input.placeholder = t('category-default');
            
            // Show success message
            const message = currentLanguage === 'en'
                ? `üìÅ Folder "${folderName}" created!`
                : `üìÅ Folder "${folderName}" dibuat!`;
            showToast(message, 3000);
            
            // Auto-open the new folder
            setTimeout(() => {
                const panel = document.getElementById(`panel-${newId}`);
                const parentDiv = document.getElementById(`cat-item-${newId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    // Update currentlyOpenPanels
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                }
                
                // Scroll to new folder
                parentDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // === 6. LANGUAGE FUNCTIONS ===
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem(LANGUAGE_KEY, lang);
            applyLanguage();
            
            // Update dropdown
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.lang === lang) {
                    option.classList.add('active');
                }
            });
            
            // Close dropdown
            document.getElementById('lang-dropdown').classList.remove('show');
            
            // Show notification
            const message = lang === 'en' 
                ? 'üåê Language changed to English' 
                : 'üåê Bahasa diubah ke Indonesia';
            showToast(message, 2000);
        }

        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('lang-dropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('lang-dropdown');
            const langBtn = document.querySelector('.lang-btn');
            
            if (dropdown && !dropdown.contains(event.target) && !langBtn.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // === 7. THEME FUNCTION ===
        function toggleTheme(e) {
            const theme = e.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const message = theme === 'dark' 
                ? 'üåô Dark mode activated' 
                : '‚òÄÔ∏è Light mode activated';
            showToast(message, 2000);
        }

        // === 8. STORAGE FUNCTIONS ===
        function saveData() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            showSaveNotification();
        }

        function resetToDefault() {
            const confirmReset = confirm(t('confirm-reset'));
            if (confirmReset) {
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
                saveData();
                render();
                showToast('üîÑ ' + t('success-reset'), 3000);
            }
        }

        function deleteAll() {
            const confirmDel = confirm(t('confirm-delete-all'));
            if (confirmDel) {
                appData = [];
                saveData();
                render();
                showToast('üóëÔ∏è ' + (currentLanguage === 'en' ? 'All data has been deleted!' : 'Semua data telah dihapus!'), 3000);
            }
        }

        function checkStorageUsage() {
            let totalSize = 0;
            
            for(let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                const size = (value.length * 2) / 1024;
                totalSize += size;
            }
            
            if (totalSize > 0) {
                showToast('üíæ ' + t('storage-info', {size: totalSize.toFixed(2)}), 3000);
            } else {
                showToast('üíæ ' + t('storage-empty'), 2000);
            }
        }

        function clearAllStorage() {
            const confirmClear = confirm(t('confirm-clear-storage'));
            if (confirmClear) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(LANGUAGE_KEY);
                localStorage.removeItem('theme');
                
                currentLanguage = 'id';
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
                
                applyLanguage();
                render();
                
                showToast('üßπ ' + t('storage-cleared'), 3000);
                showToast('üîÑ ' + (currentLanguage === 'en' ? 'App has been reset!' : 'Aplikasi telah direset!'), 3000);
            }
        }

        function showStorageNotification() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const dataSize = (savedData.length * 2) / 1024;
                showToast('üíæ ' + t('storage-info', {size: dataSize.toFixed(2)}), 4000);
            }
        }

        function showSaveNotification() {
            const message = currentLanguage === 'en' 
                ? 'üíæ Data saved to browser cache' 
                : 'üíæ Data tersimpan di cache browser';
            showToast(message, 2000);
        }

        // === 9. EXPORT/IMPORT FUNCTIONS ===
        function exportData() {
            try {
                const exportData = {
                    appData: appData,
                    language: currentLanguage,
                    theme: localStorage.getItem('theme') || 'dark',
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'text/plain' });
                const downloadUrl = URL.createObjectURL(dataBlob);
                
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = `SellerChatAssistant_Backup_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                URL.revokeObjectURL(downloadUrl);
                
                const message = currentLanguage === 'en' 
                    ? '‚úÖ All data exported successfully!'
                    : '‚úÖ Semua data berhasil diekspor!';
                showToast(message, 3000);
                
            } catch (error) {
                console.error('Export error:', error);
                const message = currentLanguage === 'en'
                    ? '‚ùå Export failed! Please try again.'
                    : '‚ùå Ekspor gagal! Silakan coba lagi.';
                showToast(message, 3000);
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.txt')) {
                const message = currentLanguage === 'en'
                    ? '‚ùå Invalid file format! Please select a .txt file.'
                    : '‚ùå Format file tidak valid! Silakan pilih file .txt.';
                showToast(message, 3000);
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const importedData = JSON.parse(content);
                    
                    if (!importedData.appData || !Array.isArray(importedData.appData)) {
                        throw new Error('Invalid data format');
                    }
                    
                    const confirmMessage = currentLanguage === 'en'
                        ? '‚ö†Ô∏è WARNING: This will replace ALL current data.\n\nAre you sure you want to import?'
                        : '‚ö†Ô∏è PERINGATAN: Ini akan menggantikan SEMUA data saat ini.\n\nApakah Anda yakin ingin mengimpor?';
                    
                    if (!confirm(confirmMessage)) {
                        event.target.value = '';
                        return;
                    }
                    
                    appData = importedData.appData;
                    
                    if (importedData.language && (importedData.language === 'id' || importedData.language === 'en')) {
                        changeLanguage(importedData.language);
                    }
                    
                    if (importedData.theme) {
                        document.documentElement.setAttribute('data-theme', importedData.theme);
                        localStorage.setItem('theme', importedData.theme);
                        document.getElementById('checkbox').checked = (importedData.theme === 'dark');
                    }
                    
                    saveData();
                    render();
                    
                    const successMessage = currentLanguage === 'en'
                        ? `‚úÖ Data imported successfully! (${importedData.appData.length} categories)`
                        : `‚úÖ Data berhasil diimpor! (${importedData.appData.length} kategori)`;
                    showToast(successMessage, 3000);
                    
                } catch (error) {
                    console.error('Import error:', error);
                    const errorMessage = currentLanguage === 'en'
                        ? '‚ùå Import failed! Invalid backup file.'
                        : '‚ùå Import gagal! File backup tidak valid.';
                    showToast(errorMessage, 3000);
                } finally {
                    event.target.value = '';
                }
            };
            
            reader.onerror = function() {
                const errorMessage = currentLanguage === 'en'
                    ? '‚ùå Failed to read file!'
                    : '‚ùå Gagal membaca file!';
                showToast(errorMessage, 3000);
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        // === 10. RENDER FUNCTIONS ===
        function render() {
            const container = document.getElementById('app-container');
            container.innerHTML = '';

            if (appData.length === 0) {
                container.innerHTML = `<div class="empty-state">${t('empty-state')}</div>`;
                return;
            }

            // Buat dua kolom untuk desktop
            if (window.innerWidth >= 768) {
                const leftColumn = document.createElement('div');
                leftColumn.className = 'left-column';
                const rightColumn = document.createElement('div');
                rightColumn.className = 'right-column';

                const midPoint = Math.ceil(appData.length / 2);
                const leftData = appData.slice(0, midPoint);
                const rightData = appData.slice(midPoint);

                leftData.forEach((cat, catIndex) => {
                    const catDiv = createCategoryItem(cat, catIndex);
                    leftColumn.appendChild(catDiv);
                });

                rightData.forEach((cat, catIndex) => {
                    const actualIndex = catIndex + midPoint;
                    const catDiv = createCategoryItem(cat, actualIndex);
                    rightColumn.appendChild(catDiv);
                });

                container.appendChild(leftColumn);
                container.appendChild(rightColumn);
            } else {
                appData.forEach((cat, catIndex) => {
                    const catDiv = createCategoryItem(cat, catIndex);
                    container.appendChild(catDiv);
                });
            }

            initializeSortable();
        }

        function createCategoryItem(cat, catIndex) {
            const catDiv = document.createElement('div');
            catDiv.className = 'category-item';
            catDiv.id = `cat-item-${cat.id}`;
            catDiv.dataset.index = catIndex;
            catDiv.style.setProperty('--color-cat', cat.color || 'var(--color-cat-default)');

            catDiv.innerHTML = `
                <div class="category-header">
                    <div class="drag-handle cat-handle"><i class="fas fa-grip-lines"></i></div>
                    <div class="header-content" onclick="togglePanel('panel-${cat.id}', 'cat-item-${cat.id}', event)">
                        <i class="fas ${cat.icon || 'fa-folder'}" style="color:var(--color-cat)"></i>
                        <span id="txt-cat-${cat.id}">${cat.title}</span>
                    </div>
                    <div style="display:flex; gap:4px;">
                        <button class="btn-icon btn-top" id="btn-edit-cat-${cat.id}" onclick="editCatMode('${cat.id}', ${catIndex}, event)"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon btn-top hidden" id="btn-save-cat-${cat.id}" onclick="saveCat('${cat.id}', ${catIndex}, event)" style="color:var(--success); border-color:var(--success)"><i class="fas fa-check"></i></button>
                        <button class="btn-icon btn-top" onclick="deleteCat(${catIndex}, event)" style="color:var(--danger); border-color:var(--danger)"><i class="fas fa-trash-alt"></i></button>
                    </div>
                </div>
                
                <div class="panel" id="panel-${cat.id}">
                    <div class="list-scripts" data-cat-index="${catIndex}"></div>
                    <button class="btn" style="width:100%; justify-content:center; margin-top:10px; border-style:dashed;" onclick="addNewItem(${catIndex})">
                        <i class="fas fa-plus"></i> ${t('add-message')}
                    </button>
                </div>
            `;

            const listContainer = catDiv.querySelector('.list-scripts');
            cat.items.forEach((item, itemIndex) => {
                const card = document.createElement('div');
                card.className = 'script-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.title}</div>
                        <div class="drag-handle card-handle"><i class="fas fa-bars"></i></div>
                    </div>

                    <div id="view-${item.id}">
                        <div class="card-body" onclick="copyText('${item.text.replace(/'/g, "\\'")}', '${item.title.replace(/'/g, "\\'")}')">${item.text}</div>
                        <div class="tap-hint">${t('tap-hint')}</div>
                        
                        <div class="btn-group" id="act-${item.id}" style="margin-top:8px;">
                            <button class="btn btn-danger" onclick="deleteItem(${catIndex}, ${itemIndex}, event)"><i class="fas fa-trash-alt"></i> ${t('delete-item')}</button>
                            <button class="btn" onclick="toggleEditItem('${item.id}', event)"><i class="fas fa-pen"></i> ${t('edit-btn')}</button>
                        </div>
                    </div>

                    <div id="edit-${item.id}" class="edit-area hidden">
                        <div id="alert-${item.id}" class="risk-alert hidden"></div>
                        <input type="text" id="inp-title-${item.id}" class="form-input" value="${item.title}" placeholder="${t('message-title')}">
                        <textarea id="inp-text-${item.id}" class="form-input" onkeyup="handleInputCheck('${item.id}')" placeholder="${t('message-content')}">${item.text}</textarea>
                        <div class="btn-group">
                            <button class="btn btn-danger" onclick="deleteItem(${catIndex}, ${itemIndex})"><i class="fas fa-trash-alt"></i> ${t('delete-item')}</button>
                            <button class="btn" onclick="toggleEditItem('${item.id}')">${t('cancel-btn')}</button>
                            <button class="btn btn-primary" onclick="saveItem('${item.id}', ${catIndex}, ${itemIndex})"><i class="fas fa-save"></i> ${t('save-btn')}</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });

            return catDiv;
        }

        // === 11. PANEL INTERACTION ===
        let currentlyOpenPanels = { left: null, right: null };

        function togglePanel(panelId, parentId, e) {
            if (e && e.target.tagName === 'INPUT') return; 

            const panel = document.getElementById(panelId);
            const parentDiv = document.getElementById(parentId);
            
            let column = 'left';
            if (window.innerWidth >= 768) {
                const leftColumn = document.querySelector('.left-column');
                const rightColumn = document.querySelector('.right-column');
                
                if (leftColumn && leftColumn.contains(parentDiv)) {
                    column = 'left';
                } else if (rightColumn && rightColumn.contains(parentDiv)) {
                    column = 'right';
                }
            } else {
                column = 'left';
            }
            
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                parentDiv.classList.remove('active-parent');
                currentlyOpenPanels[column] = null;
                return;
            }
            
            if (currentlyOpenPanels[column] && currentlyOpenPanels[column] !== panel) {
                currentlyOpenPanels[column].classList.remove('open');
                const previousParent = currentlyOpenPanels[column].parentElement;
                if (previousParent) {
                    previousParent.classList.remove('active-parent');
                }
            }
            
            panel.classList.add('open');
            parentDiv.classList.add('active-parent');
            currentlyOpenPanels[column] = panel;
        }

        // === 12. DRAG & DROP (SORTABLE) ===
        function initializeSortable() {
            document.querySelectorAll('.list-scripts').forEach(listContainer => {
                if (listContainer.children.length > 0) {
                    new Sortable(listContainer, { 
                        group: 'shared', 
                        animation: 150, 
                        handle: '.card-handle', 
                        onEnd: rebuildData,
                        ghostClass: 'sortable-ghost',
                        chosenClass: 'sortable-chosen'
                    });
                }
            });

            if (window.innerWidth >= 768) {
                document.querySelectorAll('.left-column, .right-column').forEach(column => {
                    if (column.children.length > 0) {
                        new Sortable(column, { 
                            animation: 150, 
                            handle: '.cat-handle', 
                            onEnd: function(evt) {
                                rebuildCategoryOrder();
                            },
                            ghostClass: 'sortable-ghost',
                            chosenClass: 'sortable-chosen'
                        });
                    }
                });
            } else {
                const container = document.getElementById('app-container');
                if (container.children.length > 0) {
                    new Sortable(container, { 
                        animation: 150, 
                        handle: '.cat-handle', 
                        onEnd: function(evt) {
                            rebuildCategoryOrder();
                        },
                        ghostClass: 'sortable-ghost',
                        chosenClass: 'sortable-chosen'
                    });
                }
            }
        }

        function rebuildCategoryOrder() {
            const newAppData = [];
            
            if (window.innerWidth >= 768) {
                const leftColumn = document.querySelector('.left-column');
                const rightColumn = document.querySelector('.right-column');
                
                if (leftColumn) {
                    leftColumn.querySelectorAll('.category-item').forEach(catEl => {
                        const index = parseInt(catEl.dataset.index);
                        if (index < appData.length) {
                            newAppData.push(appData[index]);
                        }
                    });
                }
                
                if (rightColumn) {
                    rightColumn.querySelectorAll('.category-item').forEach(catEl => {
                        const index = parseInt(catEl.dataset.index);
                        if (index < appData.length) {
                            newAppData.push(appData[index]);
                        }
                    });
                }
            } else {
                const container = document.getElementById('app-container');
                container.querySelectorAll('.category-item').forEach(catEl => {
                    const index = parseInt(catEl.dataset.index);
                    if (index < appData.length) {
                        newAppData.push(appData[index]);
                    }
                });
            }
            
            appData = newAppData;
            saveData();
        }

        // === 13. CRUD OPERATIONS ===
        function editCatMode(id, index, e) {
            e.stopPropagation();
            
            const contentDiv = document.getElementById(`txt-cat-${id}`).parentNode;
            const spanTitle = document.getElementById(`txt-cat-${id}`);
            
            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.id = `inp-cat-${id}`;
            inputField.value = spanTitle.innerText;
            inputField.onclick = (e) => e.stopPropagation();
            
            contentDiv.replaceChild(inputField, spanTitle);

            document.getElementById(`btn-edit-cat-${id}`).classList.add('hidden');
            document.getElementById(`btn-save-cat-${id}`).classList.remove('hidden');
            inputField.focus();
            inputField.select();
        }

        function saveCat(id, index, e) {
            e.stopPropagation();
            const inputField = document.getElementById(`inp-cat-${id}`);
            
            if (inputField) {
                appData[index].title = inputField.value;
                saveData();
                render();
            }
        }

        function deleteCat(index, e) {
            e.stopPropagation();
            if(confirm(t('confirm-delete-category'))) { 
                appData.splice(index, 1); 
                saveData(); 
                render(); 
            }
        }

        function checkContent(text) {
            return BANNED_KEYWORDS.filter(word => text.toLowerCase().includes(word));
        }

        function handleInputCheck(itemId) {
            const text = document.getElementById(`inp-text-${itemId}`).value;
            const alertBox = document.getElementById(`alert-${itemId}`);
            const violations = checkContent(text);
            if (violations.length > 0) {
                alertBox.classList.remove('hidden');
                alertBox.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <b>${t('warning-title')}:</b> ${t('warning-banned', {words: violations.join(', ')})}`;
            } else {
                alertBox.classList.add('hidden');
            }
        }

        function toggleEditItem(itemId, e) {
            if(e) e.stopPropagation();
            const view = document.getElementById(`view-${itemId}`);
            const edit = document.getElementById(`edit-${itemId}`);
            
            if(edit.classList.contains('hidden')){
                view.classList.add('hidden'); 
                edit.classList.remove('hidden');
                handleInputCheck(itemId);
            } else {
                view.classList.remove('hidden'); 
                edit.classList.add('hidden');
            }
        }

        function saveItem(itemId, catIndex, itemIndex) {
            const text = document.getElementById(`inp-text-${itemId}`).value;
            const violations = checkContent(text);
            if (violations.length > 0 && !confirm(t('confirm-banned-words', {violations: violations.join(', ')}))) return;
            
            appData[catIndex].items[itemIndex].title = document.getElementById(`inp-title-${itemId}`).value;
            appData[catIndex].items[itemIndex].text = text;
            saveData(); 
            
            const catId = appData[catIndex].id;
            render();
            
            setTimeout(() => {
                const panel = document.getElementById(`panel-${catId}`);
                const parentDiv = document.getElementById(`cat-item-${catId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                    
                    currentlyOpenPanels[column] = panel;
                }
            }, 50);
        }

        function deleteItem(catIndex, itemIndex, e) {
            if(e) e.stopPropagation();

            if(confirm(t('confirm-delete-message'))) {
                const catId = appData[catIndex].id;
                appData[catIndex].items.splice(itemIndex, 1);
                saveData(); 
                
                if (appData[catIndex].items.length > 0) {
                     render();
                    setTimeout(() => {
                        const panel = document.getElementById(`panel-${catId}`);
                        const parentDiv = document.getElementById(`cat-item-${catId}`);
                        
                        if (panel && parentDiv) {
                            panel.classList.add('open');
                            parentDiv.classList.add('active-parent');
                            
                            let column = 'left';
                            if (window.innerWidth >= 768) {
                                const leftColumn = document.querySelector('.left-column');
                                const rightColumn = document.querySelector('.right-column');
                                
                                if (leftColumn && leftColumn.contains(parentDiv)) {
                                    column = 'left';
                                } else if (rightColumn && rightColumn.contains(parentDiv)) {
                                    column = 'right';
                                }
                            }
                            
                            currentlyOpenPanels[column] = panel;
                        }
                    }, 50);
                } else {
                    render();
                }
            }
        }

        function addNewItem(catIndex) {
            appData[catIndex].items.push({ 
                id: Date.now(), 
                title: t('message-title'), 
                text: t('message-content') 
            });
            saveData(); 
            render();
            setTimeout(() => {
                const catId = appData[catIndex].id;
                const panel = document.getElementById(`panel-${catId}`);
                const parentDiv = document.getElementById(`cat-item-${catId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                    
                    currentlyOpenPanels[column] = panel;
                }
            }, 50);
        }

        function rebuildData() {
            const newAppData = [];
            document.querySelectorAll('.category-item').forEach(catEl => {
                const oldIndex = catEl.dataset.index;
                if (oldIndex < appData.length) {
                    const baseCat = appData[oldIndex];
                    const newItems = [];
                    catEl.querySelectorAll('.script-card').forEach(itemEl => {
                        const title = itemEl.querySelector('.card-title').innerText;
                        const body = itemEl.querySelector('.card-body').innerText;
                        newItems.push({ id: 'm'+Math.random().toString(36).substr(2,9), title: title, text: body });
                    });
                    baseCat.items = newItems;
                    newAppData.push(baseCat);
                }
            });
            appData = newAppData;
            saveData();
        }

        // === 14. COPY TEXT FUNCTION ===
        function copyText(txt, title = '') {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(txt).then(() => {
                    showCopySuccess(title);
                }).catch(err => {
                    fallbackCopyText(txt, title);
                });
            } else {
                fallbackCopyText(txt, title);
            }
        }

        function fallbackCopyText(txt, title = '') {
            const textArea = document.createElement("textarea");
            textArea.value = txt;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showCopySuccess(title);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                showToast('‚ùå Copy failed!', 2000);
            }
            document.body.removeChild(textArea);
        }

        function showCopySuccess(title = '') {
            const toastText = document.getElementById('toast-text');
            const successMessage = title 
                ? `‚úÖ Copied: "${title}"`
                : t('toast-text');
            
            showToast(successMessage, 2000);
        }

        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toast-text');
            
            toastText.textContent = message;
            toast.classList.add('copy-success');
            toast.className = "show";
            
            setTimeout(() => {
                toast.className = toast.className.replace("show", "");
                toast.classList.remove('copy-success');
            }, duration);
        }

        // === 15. INITIALIZE APP ===
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
